<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iris Authentication System - Biometric Security</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.37);
            --shadow-heavy: 0 20px 50px rgba(0, 0, 0, 0.15);
            --border-radius: 20px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
            z-index: -1;
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite linear;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            right: 10%;
            animation-delay: 7s;
        }

        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            bottom: 20%;
            left: 20%;
            animation-delay: 14s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.7;
            }

            50% {
                transform: translateY(-20px) rotate(180deg);
                opacity: 1;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: var(--dark-gradient);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.7;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.9;
            }
        }

        .header h1 {
            font-size: 3.5em;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            font-weight: 300;
            position: relative;
            z-index: 1;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 50px;
            position: relative;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .section:hover::before {
            left: 100%;
        }

        .section:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f8f9fa;
        }

        .section-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 20px;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            animation: iconFloat 3s ease-in-out infinite;
        }

        @keyframes iconFloat {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .section h2 {
            color: var(--text-primary);
            font-size: 2em;
            font-weight: 600;
            margin: 0;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            font-size: 16px;
            font-family: inherit;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .file-input-wrapper {
            position: relative;
            display: block;
            width: 100%;
        }

        .file-input {
            opacity: 0;
            position: absolute;
            z-index: -1;
        }

        .file-input-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px 25px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: var(--transition);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .file-input-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .btn {
            width: 100%;
            padding: 18px 30px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin: 10px 0;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.6s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            color: white;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
        }

        .btn-clear {
            background: var(--danger-gradient);
            color: white;
            box-shadow: 0 10px 30px rgba(250, 112, 154, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .image-preview {
            width: 100%;
            height: 250px;
            border: 3px dashed #dee2e6;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            background: linear-gradient(45deg, #f8f9fa, #ffffff);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
        }

        .image-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 49%, rgba(255, 255, 255, 0.1) 50%, transparent 51%);
            background-size: 20px 20px;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -100px 0;
            }

            100% {
                background-position: 100px 0;
            }
        }

        .image-preview:hover {
            border-color: #667eea;
            background: linear-gradient(45deg, #f0f2ff, #ffffff);
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            z-index: 1;
            position: relative;
        }

        .image-preview.empty {
            color: var(--text-secondary);
            font-style: italic;
            font-size: 1.1em;
        }

        .results,
        .enrolled-users {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border-left: 6px solid #667eea;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .result-success {
            border-left-color: #4facfe;
            background: linear-gradient(135deg, #e8f8ff, #ffffff);
        }

        .result-success::before {
            background: var(--success-gradient);
        }

        .result-failure {
            border-left-color: #fa709a;
            background: linear-gradient(135deg, #ffebee, #ffffff);
        }

        .result-failure::before {
            background: var(--danger-gradient);
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .info-item {
            background: rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .info-item:hover {
            transform: translateY(-5px);
            background: rgba(102, 126, 234, 0.15);
        }

        .info-item strong {
            display: block;
            color: var(--text-primary);
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-item span {
            font-size: 1.4em;
            font-weight: 700;
            color: #667eea;
        }

        .confidence-bar {
            width: 100%;
            height: 25px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            background: var(--success-gradient);
            transition: width 1s ease-out;
            border-radius: 15px;
            position: relative;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progress-shimmer 2s infinite;
        }

        @keyframes progress-shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .user-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .user-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .user-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .delete-user {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--danger-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-user:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(250, 112, 154, 0.4);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
            font-size: 0.9em;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
        }

        .status-success .status-dot {
            background: #4facfe;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }

        .status-failure .status-dot {
            background: #fa709a;
            box-shadow: 0 0 10px rgba(250, 112, 154, 0.5);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            grid-column: 1 / -1;
        }

        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading p {
            font-size: 1.2em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 15px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .message.show {
            transform: translateX(0);
        }

        .error-message {
            background: var(--danger-gradient);
        }

        .success-message {
            background: var(--success-gradient);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 30px;
                padding: 30px 20px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2.5em;
            }

            .section {
                padding: 30px 20px;
            }

            .result-info {
                grid-template-columns: 1fr;
            }

            .user-list {
                grid-template-columns: 1fr;
            }
        }

        .stats-banner {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 250, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>

<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-eye"></i> Iris Authentication</h1>
            <p class="subtitle">Advanced Biometric Security System with Neural Pattern Recognition</p>
        </div>

        <div class="main-content">
            <!-- Enrollment Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h2>User Enrollment</h2>
                </div>

                <div class="form-group">
                    <label for="enrollSubjectId"><i class="fas fa-id-card"></i> Subject ID</label>
                    <input type="text" id="enrollSubjectId" placeholder="Enter unique identifier (e.g., user_001)"
                        required>
                </div>

                <div class="form-group">
                    <label for="enrollEye"><i class="fas fa-eye"></i> Eye Selection</label>
                    <select id="enrollEye">
                        <option value="L">👁️ Left Eye</option>
                        <option value="R">👁️ Right Eye</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="enrollImage"><i class="fas fa-camera"></i> Iris Image</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="enrollImage" class="file-input" accept="image/*" required>
                        <label for="enrollImage" class="file-input-button">
                            <i class="fas fa-cloud-upload-alt"></i>
                            Choose Iris Image
                        </label>
                    </div>
                </div>

                <div class="image-preview empty" id="enrollPreview">
                    <i class="fas fa-image" style="font-size: 3em; opacity: 0.3;"></i>
                    <p style="margin-top: 10px;">No image selected</p>
                </div>

                <button class="btn btn-primary" id="enrollBtn" onclick="enrollUser()">
                    <i class="fas fa-user-plus"></i>
                    <span>Enroll User</span>
                </button>
            </div>

            <!-- Authentication Section -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h2>Authentication</h2>
                </div>

                <div class="form-group">
                    <label for="authImage"><i class="fas fa-search"></i> Test Iris Image</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="authImage" class="file-input" accept="image/*" required>
                        <label for="authImage" class="file-input-button">
                            <i class="fas fa-fingerprint"></i>
                            Choose Test Image
                        </label>
                    </div>
                </div>

                <div class="image-preview empty" id="authPreview">
                    <i class="fas fa-image" style="font-size: 3em; opacity: 0.3;"></i>
                    <p style="margin-top: 10px;">No image selected</p>
                </div>

                <button class="btn btn-secondary" id="authBtn" onclick="authenticateUser()">
                    <i class="fas fa-lock"></i>
                    <span>Authenticate</span>
                </button>

                <button class="btn"
                    style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; box-shadow: 0 10px 30px rgba(155, 89, 182, 0.3);"
                    onclick="loadEnrolledUsers()">
                    <i class="fas fa-users"></i>
                    <span>View Enrolled Users</span>
                </button>

                <button class="btn btn-clear" onclick="clearAllUsers()">
                    <i class="fas fa-trash-alt"></i>
                    <span>Clear All Users</span>
                </button>
            </div>

            <!-- Loading Section -->
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p><i class="fas fa-cog fa-spin"></i> Processing iris biometric data...</p>
            </div>

            <!-- Results Section -->
            <div class="results" id="resultsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h2>Authentication Results</h2>
                </div>
                <div id="resultsContent"></div>
            </div>

            <!-- Enrolled Users Section -->
            <div class="enrolled-users" id="enrolledSection" style="display: none;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <h2>Enrolled Users Database</h2>
                </div>
                <div class="stats-banner" id="statsBanner">
                    <div class="stat-item">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="leftEyeCount">0</div>
                        <div class="stat-label">Left Eyes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="rightEyeCount">0</div>
                        <div class="stat-label">Right Eyes</div>
                    </div>
                </div>
                <div class="user-list" id="userList"></div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = window.location.origin;

        // Image preview functionality
        document.getElementById('enrollImage').addEventListener('change', function (e) {
            previewImage(e.target, 'enrollPreview');
        });

        document.getElementById('authImage').addEventListener('change', function (e) {
            previewImage(e.target, 'authPreview');
        });

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                    preview.classList.remove('empty');
                };

                reader.readAsDataURL(input.files[0]);
            } else {
                preview.innerHTML = `
                    <i class="fas fa-image" style="font-size: 3em; opacity: 0.3;"></i>
                    <p style="margin-top: 10px;">No image selected</p>
                `;
                preview.classList.add('empty');
            }
        }

        async function enrollUser() {
            const subjectId = document.getElementById('enrollSubjectId').value;
            const eye = document.getElementById('enrollEye').value;
            const imageFile = document.getElementById('enrollImage').files[0];

            if (!subjectId || !imageFile) {
                showError('Please fill in all fields and select an image.');
                return;
            }

            const enrollBtn = document.getElementById('enrollBtn');
            enrollBtn.disabled = true;
            enrollBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Enrolling...</span>';

            try {
                showLoading();

                const formData = new FormData();
                formData.append('subject_id', subjectId);
                formData.append('eye', eye);
                formData.append('image', imageFile);

                const response = await fetch(`${API_BASE}/enroll`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                hideLoading();

                if (response.ok) {
                    showResults(`
                        <div class="result-card result-success">
                            <h3><i class="fas fa-check-circle"></i> Enrollment Successful <span class="status-indicator status-success"><span class="status-dot"></span>Active</span></h3>
                            <p><strong><i class="fas fa-user"></i> User:</strong> ${result.subject_id}_${result.eye}</p>
                            <p><strong><i class="fas fa-image"></i> Image:</strong> ${imageFile.name}</p>
                            <p><strong><i class="fas fa-info-circle"></i> Message:</strong> ${result.message}</p>
                            <div style="margin-top: 20px; padding: 15px; background: rgba(79, 172, 254, 0.1); border-radius: 10px;">
                                <i class="fas fa-fingerprint"></i> Biometric template successfully created and stored in secure database
                            </div>
                        </div>
                    `);

                    // Clear form
                    document.getElementById('enrollSubjectId').value = '';
                    document.getElementById('enrollImage').value = '';
                    document.getElementById('enrollPreview').innerHTML = `
                        <i class="fas fa-image" style="font-size: 3em; opacity: 0.3;"></i>
                        <p style="margin-top: 10px;">No image selected</p>
                    `;
                    document.getElementById('enrollPreview').classList.add('empty');

                    showSuccess('User enrolled successfully!');

                    // Refresh user list if visible
                    if (document.getElementById('enrolledSection').style.display === 'block') {
                        await loadEnrolledUsers();
                    }
                } else {
                    showError(`Enrollment failed: ${result.detail}`);
                }

            } catch (error) {
                hideLoading();
                showError(`Network error: ${error.message}`);
            } finally {
                enrollBtn.disabled = false;
                enrollBtn.innerHTML = '<i class="fas fa-user-plus"></i><span>Enroll User</span>';
            }
        }

        async function authenticateUser() {
            const imageFile = document.getElementById('authImage').files[0];

            if (!imageFile) {
                showError('Please select an iris image for authentication.');
                return;
            }

            const authBtn = document.getElementById('authBtn');
            authBtn.disabled = true;
            authBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Authenticating...</span>';

            try {
                showLoading();

                const formData = new FormData();
                formData.append('image', imageFile);

                const response = await fetch(`${API_BASE}/authenticate`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                hideLoading();

                if (response.ok) {
                    displayAuthResult(result);

                    // Clear form
                    document.getElementById('authImage').value = '';
                    document.getElementById('authPreview').innerHTML = `
                        <i class="fas fa-image" style="font-size: 3em; opacity: 0.3;"></i>
                        <p style="margin-top: 10px;">No image selected</p>
                    `;
                    document.getElementById('authPreview').classList.add('empty');
                } else {
                    showError(`Authentication failed: ${result.detail}`);
                }

            } catch (error) {
                hideLoading();
                showError(`Network error: ${error.message}`);
            } finally {
                authBtn.disabled = false;
                authBtn.innerHTML = '<i class="fas fa-lock"></i><span>Authenticate</span>';
            }
        }

        function displayAuthResult(result) {
            const statusClass = result.success ? 'result-success' : 'result-failure';
            const statusIcon = result.success ? 'fas fa-check-circle' : 'fas fa-times-circle';
            const statusText = result.success ? 'AUTHENTICATED' : 'AUTHENTICATION FAILED';
            const statusIndicator = result.success ? 'status-success' : 'status-failure';

            const confidencePercent = (result.confidence * 100).toFixed(1);
            const confidenceColor = result.confidence >= 0.9 ? '#4facfe' :
                result.confidence >= 0.7 ? '#f39c12' : '#fa709a';

            showResults(`
                <div class="result-card ${statusClass}">
                    <h3><i class="${statusIcon}"></i> ${statusText} <span class="status-indicator ${statusIndicator}"><span class="status-dot"></span>${result.success ? 'VERIFIED' : 'REJECTED'}</span></h3>
                    ${result.success ? `<p><strong><i class="fas fa-user-check"></i> Matched User:</strong> ${result.matched_id}</p>` :
                    `<p><strong><i class="fas fa-user-times"></i> Best Match:</strong> ${result.matched_id || 'None'}</p>`}
                    
                    <div class="result-info">
                        <div class="info-item">
                            <strong><i class="fas fa-percentage"></i> Confidence</strong>
                            <span style="color: ${confidenceColor}">${confidencePercent}%</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-ruler"></i> Hamming Distance</strong>
                            <span>${result.hamming_distance.toFixed(4)}</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-sliders-h"></i> Threshold</strong>
                            <span>${result.threshold}</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-flag"></i> Status</strong>
                            <span style="color: ${result.success ? '#4facfe' : '#fa709a'}">
                                ${result.success ? 'PASS' : 'FAIL'}
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px;">
                        <strong><i class="fas fa-chart-bar"></i> Confidence Level:</strong>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidencePercent}%; background: linear-gradient(90deg, ${confidenceColor}, ${confidenceColor}aa)"></div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 10px; font-size: 0.9em;">
                            <i class="fas fa-info-circle"></i> ${result.success ?
                    'Biometric pattern successfully matched against enrolled template' :
                    'Biometric pattern does not match any enrolled templates'}
                        </div>
                    </div>
                </div>
            `);
        }

        async function loadEnrolledUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                const data = await response.json();

                if (response.ok) {
                    displayEnrolledUsers(data.users);
                } else {
                    showError(`Failed to load users: ${data.detail}`);
                }
            } catch (error) {
                showError(`Network error: ${error.message}`);
            }
        }

        function displayEnrolledUsers(users) {
            // Update stats
            const totalUsers = users.length;
            const leftEyeCount = users.filter(u => u.eye === 'L').length;
            const rightEyeCount = users.filter(u => u.eye === 'R').length;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('leftEyeCount').textContent = leftEyeCount;
            document.getElementById('rightEyeCount').textContent = rightEyeCount;

            if (users.length === 0) {
                document.getElementById('userList').innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #7f8c8d; grid-column: 1 / -1;">
                        <i class="fas fa-users" style="font-size: 4em; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h3>No users enrolled yet</h3>
                        <p>Start by enrolling your first user using the enrollment section</p>
                    </div>
                `;
            } else {
                const userListHTML = users.map(user => `
                    <div class="user-card">
                        <button class="delete-user" onclick="deleteUser('${user.subject_id}', '${user.eye}')" title="Delete User">
                            <i class="fas fa-times"></i>
                        </button>
                        <div style="margin-bottom: 15px;">
                            <i class="fas fa-user-circle" style="font-size: 3em; color: #667eea; margin-bottom: 10px;"></i>
                        </div>
                        <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3em;">${user.subject_id}_${user.eye}</h4>
                        <div style="text-align: left; background: rgba(0,0,0,0.03); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong><i class="fas fa-image"></i> Image:</strong> ${user.image_path}</p>
                            <p><strong><i class="fas fa-hashtag"></i> Hash:</strong> <code style="background: rgba(102,126,234,0.1); padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">${user.feature_hash}</code></p>
                            <p><strong><i class="fas fa-calendar"></i> Enrolled:</strong> ${new Date(user.created_at).toLocaleString()}</p>
                        </div>
                        <div style="margin-top: 15px;">
                            <span class="status-indicator status-success">
                                <span class="status-dot"></span>
                                Active Template
                            </span>
                        </div>
                    </div>
                `).join('');

                document.getElementById('userList').innerHTML = userListHTML;
            }

            document.getElementById('enrolledSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
        }

        async function deleteUser(subjectId, eye) {
            if (!confirm(`⚠️ Are you sure you want to delete user ${subjectId}_${eye}?\n\nThis action cannot be undone and will permanently remove their biometric template.`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/delete_user/${subjectId}/${eye}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showSuccess(`User ${subjectId}_${eye} deleted successfully`);
                    await loadEnrolledUsers(); // Refresh the list
                } else {
                    showError(`Failed to delete user: ${result.detail}`);
                }
            } catch (error) {
                showError(`Network error: ${error.message}`);
            }
        }

        async function clearAllUsers() {
            if (!confirm('🚨 DANGER: Are you sure you want to delete ALL enrolled users?\n\nThis will permanently remove all biometric templates from the database.\n\nThis action cannot be undone!')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/clear_all_users`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showSuccess('All users cleared successfully');
                    await loadEnrolledUsers(); // Refresh the list
                } else {
                    showError(`Failed to clear users: ${result.detail}`);
                }
            } catch (error) {
                showError(`Network error: ${error.message}`);
            }
        }

        function showLoading() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('enrolledSection').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
        }

        function showResults(content) {
            document.getElementById('resultsContent').innerHTML = content;
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('enrolledSection').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'message error-message';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            document.body.appendChild(errorDiv);

            setTimeout(() => errorDiv.classList.add('show'), 100);

            setTimeout(() => {
                errorDiv.classList.remove('show');
                setTimeout(() => errorDiv.remove(), 500);
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'message success-message';
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            document.body.appendChild(successDiv);

            setTimeout(() => successDiv.classList.add('show'), 100);

            setTimeout(() => {
                successDiv.classList.remove('show');
                setTimeout(() => successDiv.remove(), 500);
            }, 3000);
        }

        // Initialize by loading enrolled users
        window.onload = function () {
            loadEnrolledUsers();
        };
    </script>
</body>

</html>